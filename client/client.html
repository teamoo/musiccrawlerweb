<head>
  <title>MusicCrawler</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
	{{> page}}
</body>

<template name="page">
				{{#if session "showAccountSettingsDialog"}}
				  {{> accountSettingsDialog}}
				{{/if}}
				
				{{#if session "showAddLinkDialog"}}
				  {{> addLinkDialog}}
				{{/if}}
				
				{{#if session "showAddSiteDialog"}}
				  {{> addSiteDialog}}
				{{/if}}
				
				{{#if session "showSitesDialog"}}
				  {{> sitesDialog}}
				{{/if}}
				{{#if notConnected}}
					{{> connectionLostWarning}}
				{{/if}}
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">
				{{>navigation}}
			</div>
		</div>
		<div class="row-fluid">
			<div class="span12">
				{{#if currentUser}}
					{{> linklist}}
				{{else}}
					<p class="lead">Bitte logge dich ein, um auf MusicCrawler zuzugreifen.</p>
				{{/if}}
			</div>
		</div>
	</div>
</template>  

<template name="connectionLostWarning">
	<div class="alert alert-error alert-block">
		<h4 class="error heading">Achtung!</h4>
		<p>Anscheinend hast du die Verbindung zum Server verloren. Wir versuchen dich automatisch wieder zu verbinden. Sollte dies innerhalb von 1 Minute nicht klappen, schließe bitte diese Seite und öffne sie erneut.</p>
		<p>
			<a class="btn btn-danger" id="terminateappbutton">Anwendung beenden</a>
			<a class="btn">Warten</a>
		</p>
	</div>
</template>

<template name="progressBar">
	<div class="progress progress-striped active">
		<div class="bar" style="width: 40%;"></div>
	</div>
</template>

<template name="navigation">
	<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<a class="brand">MusicCrawler</a>
			<ul class="nav" role="navigation">
				<li class="dropdown">
                      <a id="drop1" role="button" class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="drop1">
							<li class="linkfilter {{getClass}}"><a tabindex="-1" id="1">Letzte 24 Stunden <span class="badge" id="1">{{getLinkCount}}</span></a></li>
							<li class="linkfilter {{getClass}}"><a tabindex="-1" id="14">Letzte 14 Tage <span class="badge" id="14">{{getLinkCount}}</span></a></li>
							<li class="linkfilter {{getClass}}"><a tabindex="-1" id="30">Letzte 30 Tage <span class="badge" id="30">{{getLinkCount}}</span></a></li>
							<li class="linkfilter {{getClass}}"><a tabindex="-1" id="90">Letzte 90 Tage <span class="badge" id="90">{{getLinkCount}}</span></a></li>
							<li class="divider"></li>
							<li class="linkfilter {{getClass}}"><a tabindex="-1" id="365">Letztes Jahr </a></li>
                      </ul>
                </li>
				<li class="dropdown">
                      <a id="drop2" role="button" class="dropdown-toggle" data-toggle="dropdown">Seiten <b class="caret"></b></a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="drop2">
                        	<li><a tabindex="-1" id="addsitebutton"><i class="icon-plus"></i> Seite hinzufügen</a></li>
							<li class="divider"></li>
							<li><a tabindex="-1" id="showsitesbutton"><i class="icon-th-list"></i> Seiten anzeigen</a></li>
                      </ul>
                </li>
				<li class="divider-vertical"></li>
				<a class="btn" id="addlinkbutton"><i class="icon-plus"></i> Link hinzufügen</a>
				{{#if isAnyLinkSelected}}
					<a class="btn" id="copybutton"><i class="icon-file"></i> Zwischenablage</a>
					<a class="btn btn-primary" id="downloadbutton"><i class="icon-circle-arrow-down icon-white"></i> Download (via JDownloader)</a>
				{{else}}
					<a class="btn" id="copybutton" disabled><i class="icon-file"></i> Zwischenablage</a>
					<a class="btn btn-primary" id="downloadbutton" disabled><i class="icon-circle-arrow-down icon-white"></i> Download (via JDownloader)</a>
				{{/if}}
			</ul>
			<ul class="nav pull-right">
				<li>
					<form class="navbar-search pull-right" id="searchform">
						<input type="text" class="search-query" placeholder="Titel, Interpret, Album..." id="searchfield" value="{{getLastSearchTerm}}">
					</form>
				</li>
				<li class="divider-vertical"></li>
				<li>
					<div class="btn-group">
						{{> user_info}}		  
					</div>
				</li>
			</ul>
		</div>
	</div>
</template>

<template name="user_info">
		{{#if currentUser}}
			{{> user_loggedin}}
		{{else}}
			{{> user_loggedout}}
		{{/if}}
</template>

<template name="user_loggedin">
	{{#if loggingIn}}
		<a class="btn"><i class="icon-user"></i> Einloggen...</a>
	{{else}}
		<a class="btn" id="accountbtn" rel="popover" data-original-title="{{currentUser.profile.name}}" data-placement="bottom"><i class="icon-user"></i> {{currentUser.profile.first_name}}</a>
		<a class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></a>
		<ul class="dropdown-menu pull-right">
			<li><a id="showsettings"><i class="icon-wrench"></i> Einstellungen</a></li>
			<li class="divider"></li>
			<li><a id="logout"><i class="icon-off"></i> Abmelden</a></li>
		</ul>
	{{/if}}
</template>

<template name="user_loggedout">
		<a class="btn" id="login"><i class="icon-user"></i> Login</a>
</template>

<template name="linklist">
  <table class="table table-condensed table-striped">
	<thead>
		<th>
			<input type="checkbox" value="" id="select_all">
		</th>
		<th></th>
		<th><i class="icon-volume-up"></i></th>
		<th>Name</th>
		<th>URL</th>
		<th></th>
		<th></th>
		<th>
			<i class="icon-filter hand" id="filter_links"></i> Status
		</th>
		<th>Quelle</th>
		<th>Größe</th>
		<th>Hinzugefügt</th>
		</thead>
          	{{#if links}}
			<tbody>
			{{#each links}}
				{{> link}}
			{{/each}}
			</tbody>
			</table>
			{{else}}
				</table>
				<p class="lead">Für den ausgewählten Zeitraum wurden keine Links gefunden.</p>
			{{/if}}
</template>

<template name="comment">
	<div class="span4 well">
		<form accept-charset="UTF-8" action="" method="">
			<textarea class="span4" id="new_comment" name="new_comment"
			placeholder="Kommentar eingeben" rows="5"></textarea>
			<button class="btn btn-info" type="submit">Posten</button>
		</form>
	</div>
</template>

<template name="link">
  <tr>
	<td>
		{{#if isLinkSelected}}
			<input type="checkbox" class="link_checkbox" id="{{_id}}" checked="checked">
		{{else}}
			<input type="checkbox" class="link_checkbox" id="{{_id}}">
		{{/if}}
	</td>
	<td>
		<i class="icon-refresh hand" id="{{_id}}"></i>
	</td>
	<td>
		{{{getPlayerWidget}}}
	</td>
    <td><a class="linkname" data-mode="inline" data-name="linkname" data-type="text" data-pk="{{_id}}">{{name}}</a></td>
    <td>{{url}}</td>
	<td>
		{{#if comments}}
			<i class="icon-comment hand" id="{{_id}}"></i>
			<div class="popover left" id="{{_id}}_comments" date-title="Kommentare" data-trigger:"hover">
				<div class="arrow"></div>
				<h3 class="popover-title">Titel</h3>
				<div class="popover-content">
					{{#each comments}}
						{{message}}
					{{/each}}
				</div>
			</div>
		{{else}}
			<i class="icon-comment icon-white hand" id="{{_id}}"></i>
			<div class="popover left" id="{{_id}}">
				<div class="arrow"></div>
				<h3 class="popover-title">Titel</h3>
				<div class="popover-content">
					<p>Text...</p>
				</div>
			</div>
		{{/if}}
	</td>
	<td>
		<i class="icon-thumbs-up hand like" id="{{_id}}"></i>
		{{#if likes}}{{likes}}{{else}}0{{/if}}
	</td>
	<td>
		<i class="{{getStatusIcon}}"></i>
	</td>
	<td>{{getSourceName}}</td>
	<td>{{getSizeinMB}}</td>
	<td>	{{dateFormat date format="DD. MMM YYYY"}}</td>
  </tr>
</template>

<template name="accountSettingsDialog">
<div class="mask"> </div>
<div id="accountSettingsModal" class="modal">
  <div class="modal-header">
	<button type="button" class="close cancel" aria-hidden="true">&times;</button>
    <h3 align="center">Kontoeinstellungen</h3>
  </div>
  <div class="modal-body">
	<form class="form-horizontal">
		<span class="help-inline">IP-Adresse:</span>
		<div class="input-append">
			<span class="input-medium uneditable-input ip">{{currentUser.profile.ip}}</span>
			<button class="btn btn-link" type="button">Aktualisieren</button>
		</div>
		<span class="help-inline">Port:</span>
		<input class="input-mini port" type="text" value={{currentUser.profile.port}}>
		<label class="checkbox">
		<input class="autoupdate" type="checkbox" checked={{currentUser.profile.autoupdateip}}>
		IP-Adresse automatisch updaten?
		</label>
		<span class="help-inline">Status:</span>
		<input class="input-mini port" type="text" value={{session "JDOnlineStatus"}}>
	</form>
  </div>
  <div class="modal-footer">
    <button class="btn cancel" data-dismiss="modal" aria-hidden="true">Schließen</button>
    <button class="btn btn-primary save">Speichern</button>
  </div>
</div>
</template>

<template name="addLinkDialog">
<div class="mask"> </div>
<div id="addLinkModal" class="modal">
  <div class="modal-header">
	<button type="button" class="close cancel">&times;</button>
    <h3 align="center">Link hinzufügen</h3>
  </div>
  <div class="modal-body" id="addlinkform">
	<form class="form-inline">
		<div class="input-append">
			<input id="newlinkurl" class="input-xlarge linkurl" type="url" placeholder="http://www28.zippyshare.com/v/82393135/file.html" required>
			<button class="btn addlink" type="button" disabled>Hinzufügen</button>
		</div>
	</form>
  </div>
  <div class="modal-footer">
    {{#if error}}
        <div class="alert alert-error">{{error}}</div>
    {{/if}}
  </div>
</div>
</template>

<template name="addSiteDialog">
<div class="mask"> </div>
<div id="addSiteModal" class="modal">
  <div class="modal-header">
	<button type="button" class="close cancel">&times;</button>
    <h3 align="center">Musik-Blog hinzufügen</h3>
  </div>
  <div class="modal-body">
	<form class="form-horizontal" id="addsiteform">
		<div class="input-append">
			<span class="help-inline">URL der Seite, die wir nach Links durchsuchen sollen</span>
			<input id="newsiteurl" class="input-xlarge siteurl" type="url" placeholder="http://www.electrotechnosuperblog.com" required>
			<button class="btn btn-primary addsite" disabled>Seite hinzufügen</button>
		</div>
	</form>
  </div>
  <div class="modal-footer">
    {{{session "status"}}}
  </div>
</div>
</template>

<template name="sitesDialog">
<div class="mask"> </div>
<div id="showSitesModal" class="modal">
  <div class="modal-header">
	<button type="button" class="close cancel">&times;</button>
    <h3 align="center">Musik-Blogs</h3>
  </div>
  <div class="modal-body">
		<table class="table table-striped table-condensed">
		<thead>
			<th><i class="icon-trash"></i></th>
			<th>Name</th>
			<th>URL</th>
			<th>Typ</th>
			<th>aktiv</th>
		</thead>
		<tbody>
			{{#each sites}}
				<tr>
					<td>
						{{#if isOwner}}
							<i class="icon-trash"></i>
						{{/if}}
					</td>
					<td>
						{{#if isOwner}}
							<a class="sitename" data-mode="inline" data-name="name" data-type="text" data-pk="{{_id}}">{{name}}</a>
						{{else}}
							{{name}}
						{{/if}}
					</td>
					<td>{{feedurl}}</td>
					<td><i class="{{getFeedTypeIcon}}"></i></td>
					<td>
						{{#if active}}
							<i class="icon-ok-sign"></i>
						{{/if}}
					</td>
				</tr>
			{{/each}}
		</tbody>
		</table>
  </div>
</div>
</template>