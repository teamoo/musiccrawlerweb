<head>
  <title>MusicCrawler</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
	{{> page}}
</body>

<template name="page">
				{{#if session "showAccountSettingsDialog"}}
				  {{> accountSettingsDialog}}
				{{/if}}
				
				{{#if session "showAddLinkDialog"}}
				  {{> addLinkDialog}}
				{{/if}}
				
				{{#if session "showAddSiteDialog"}}
				  {{> addSiteDialog}}
				{{/if}}
				
				{{#if session "showSitesDialog"}}
				  {{> sitesDialog}}
				{{/if}}
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">
				{{> navigation}}
				{{#if notConnected}}
					{{> connectionLostWarning}}
				{{/if}}
			</div>
		</div>
		<div class="row-fluid">
			<div class="span12">
				{{#if currentUser}}
					{{# if linksFound}}
						{{> linklist}}
					{{else}}
						<p class="lead">Für den ausgewählten Zeitraum oder Suchbegriff wurden keine Links in der Datenbank gefunden.</p>
						{{#if searchresultsFound}}
							<p class="lead">Folgende externe Links wurden für den Suchbegriff <b><i>{{session "filter_term_external"}}</i></b> gefunden:</p>
							{{> searchresultlist}}
						{{else}}
							<p class="lead">Es wurden leider auch keine externen Links gefunden.</p>
						{{/if}}
					{{/if}}	
				{{else}}
					<p class="lead">Bitte logge dich ein, um auf MusicCrawler zuzugreifen.</p>
				{{/if}}
			</div>
		</div>
		<div class="row-fluid">
			<div class="span12">
				{{#if session "progress"}}
					{{> progressBar}}
				{{/if}}
			</div>
		</div>
	</div>
</template>  

<template name="connectionLostWarning">
	<div class="alert alert-error alert-block">
		<h4 class="error heading">Achtung!</h4>
		<p>Anscheinend hast du die Verbindung zum Server verloren. Wir versuchen dich automatisch wieder zu verbinden. Sollte dies innerhalb von 1 Minute nicht klappen, schließe bitte diese Seite und öffne sie erneut.</p>
		<p>
			<a class="btn btn-danger" id="terminateappbutton">Anwendung beenden</a>
			<a class="btn">Warten</a>
		</p>
	</div>
</template>

<template name="progressBar">
	{{#if session "progressActive"}}
		<div class="progress progress-striped active {{session "progressState"}}">
			<div class="bar" style="width: {{session "progress"}}%;"></div>
		</div>
	{{else}}
		<div class="progress {{session "progressState"}}">
			<div class="bar" style="width: {{session "progress"}}%;"></div>
		</div>
	{{/if}}
</template>

<template name="navigation">
	<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<a class="brand" style="margin-left:-15px">MusicCrawler</a>
			{{#if currentUser}}
				<ul class="nav" role="navigation">
					<li class="dropdown">
	                      <a id="drop1" role="button" class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
	                      	<ul class="dropdown-menu" role="menu" aria-labelledby="drop1">
	                      			<li class="linkfilter"><a tabindex="-1" id="1">Letzte 24 Stunden <span class="badge" id="1">0</span></a></li>
	                      			<li class="linkfilter"><a tabindex="-1" id="14">Letzte 14 Tage <span class="badge" id="14">0</span></a></li>
	                      			<li class="linkfilter"><a tabindex="-1" id="30">Letzte 30 Tage <span class="badge" id="30">0</span></a></li>
	                      			<li class="linkfilter"><a tabindex="-1" id="90">Letzte 90 Tage <span class="badge" id="90">0</span></a></li>
	                      			<li class="divider"></li>
	                      			<li class="linkfilter"><a tabindex="-1" id="365">Letztes Jahr <span class="badge" id="365">0</span></a></li>
	                      	</ul>
	                </li>
					<li class="dropdown">
	                      <a id="drop2" role="button" class="dropdown-toggle" data-toggle="dropdown">Seiten <b class="caret"></b></a>
	                      <ul class="dropdown-menu" role="menu" aria-labelledby="drop2">
	                      		<li><a tabindex="-1" id="addsitebutton"><i class="icon-plus"></i> Seite hinzufügen</a></li>
	                      		<li class="divider"></li>
	                      		<li><a tabindex="-1" id="showsitesbutton"><i class="icon-th-list"></i> Seiten anzeigen <span class="badge">{{getSiteCount}}</span></a></li>
	                      </ul>
	                </li>
					<li class="divider-vertical"></li>
					<a class="btn" id="addlinkbutton"><i class="icon-plus"></i> Link hinzufügen</a>
					{{#if isAnyLinkSelected}}
						<a class="btn" id="copybutton"><i class="icon-file"></i> Zwischenablage</a>
						{{#if session "JDOnlineStatus"}}
							<a class="btn btn-primary" id="downloadbutton"><i class="icon-circle-arrow-down icon-white"></i> Download (via JDownloader)</a>
						{{else}}
							<a class="btn btn-primary" id="downloadbutton" disabled><i class="icon-circle-arrow-down icon-white"></i> Download (via JDownloader)</a>
						{{/if}}
					{{else}}
						<a class="btn" id="copybutton" disabled><i class="icon-file"></i> Zwischenablage</a>
						<a class="btn btn-primary" id="downloadbutton" disabled><i class="icon-circle-arrow-down icon-white"></i> Download (via JDownloader)</a>
					{{/if}}
				</ul>
				<ul class="nav pull-right">
					<li>
						<form class="navbar-search pull-right" id="searchform">
							<input type="text" class="search-query" placeholder="Titel, Interpret, Album..." id="searchfield" value="{{getLastSearchTerm}}">
						</form>
					</li>
					<li class="divider-vertical"></li>
					<li>
						<div class="btn-group">
							{{> user_info}}		  
						</div>
					</li>
				</ul>
			{{else}}
				<ul class="nav pull-right">
					<li>
						<div class="btn-group">
							{{> user_info}}
						</div>
					</li>
				</ul>
			{{/if}}
		</div>
	</div>
</template>

<template name="user_info">
		{{#if currentUser}}
			{{> user_loggedin}}
		{{else}}
			{{> user_loggedout}}
		{{/if}}
</template>

<template name="user_loggedin">
	{{#if loggingIn}}
		<a class="btn"><i class="icon-user"></i> Einloggen...</a>
	{{else}}
		<a class="btn" id="accountbtn" rel="popover" data-original-title="{{currentUser.profile.name}}" data-placement="bottom"><i class="icon-user"></i> {{currentUser.profile.first_name}}</a>
		<a class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></a>
		<ul class="dropdown-menu pull-right">
			<li><a id="showsettings"><i class="icon-wrench"></i> Einstellungen</a></li>
			<li class="divider"></li>
			<li><a id="logout"><i class="icon-off"></i> Abmelden</a></li>
		</ul>
	{{/if}}
</template>

<template name="user_loggedout">
		<a class="btn" id="login"><i class="icon-user"></i> Login</a>
</template>

<template name="linklist">
	<table class="table table-condensed table-striped">
		<thead>
			<th>
				<input type="checkbox" id="select_all">
			</th>
			<th></th>
			<th><i class="icon-volume-up"></i></th>
			<th>Name</th>
			<th>URL</th>
			<th></th>
			<th></th>
			<th>
				<i class="icon-filter hand" id="filter_links"></i> Status
			</th>
			<th>Quelle</th>
			<th>Größe</th>
			<th>Hinzugefügt</th>
		</thead>
		<tbody>
			{{#each links}}
				{{> link}}
			{{/each}}
		</tbody>
	</table>
</template>

<template name="link">
  <tr>
	<td>
		{{#if isLinkSelected}}
			<input type="checkbox" class="link_checkbox" id="{{_id}}" checked="checked">
		{{else}}
			<input type="checkbox" class="link_checkbox" id="{{_id}}">
		{{/if}}
	</td>
	<td>
		<i class="icon-refresh hand" id="{{_id}}"></i>
	</td>
	<td>
		{{{getPlayerWidget}}}
	</td>
    <td><a class="linkname" data-mode="inline" data-name="linkname" data-type="text" data-pk="{{_id}}">{{name}}</a></td>
    <td><a href="{{url}}" target="_blank">{{url}}</a></td>
	<td>
		{{#if comments}}
			<i class="icon-comment hand" rel="popover" id="{{_id}}_comments"></i>
		{{else}}
			<i class="icon-comment icon-white hand" rel="popover" id="{{_id}}_comments"></i>
		{{/if}}
	</td>
	<td>
		<i class="icon-thumbs-up hand like" id="{{_id}}"></i>
		{{#if likes}}{{likes}}{{else}}0{{/if}}
	</td>
	<td style="text-align: center;">
		<i class="{{getStatusIcon}}"></i>
	</td>
	<td>{{getSourceName}}</td>
	<td style="text-align: right">{{getSizeinMB}}</td>
	<td>	{{dateFormat date_discovered format="DD. MMM YYYY"}}</td>
  </tr>
</template>

<template name="searchresultlist">
	<table class="table table-condensed">
	<thead>
		<th>Quelle</th>
		<th>Name</th>
		<th>Duration</th>
		<th></th>
	</thead>
	{{#each searchresults}}
		{{> searchresult}}
	{{/each}}
	</table>
</template>

<template name="searchresult">
  <tr>
	<td>
		{{source}}
	</td>
    <td><a href="{{url}}" target="_blank">{{name}}</a></td>
	<td>{{duration}}</td>	
	<td><a class="btn btn-small"><i class="icon-plus"></i> Link zur Datenbank hinzufügen</a></td>
  </tr>
</template>

<template name="accountSettingsDialog">
<div class="mask"> </div>
<div id="accountSettingsModal" class="modal">
  <div class="modal-header">
	<button type="button" class="close cancel" aria-hidden="true">&times;</button>
    <h3 align="center">Kontoeinstellungen</h3>
  </div>
  <div class="modal-body">
	<form class="form-horizontal">
		<span class="help-inline">IP-Adresse:</span>
			{{#if currentUser.profile.autoupdateip}}
				<input class="input-medium" id="ip" type="text" value={{currentUser.profile.ip}} disabled>
			{{else}}
				<input class="input-medium" id="ip" type="text" value={{currentUser.profile.ip}}>
			{{/if}}
			<button class="btn btn-link" type="button" id="refreship">Aktualisieren</button>
		<span class="help-inline">Port:</span>
		<input class="input-mini" id="port" type="text" value={{currentUser.profile.port}}>
		<label class="checkbox">
		<br/>
		{{#if currentUser.profile.autoupdateip}}
			<input id="autoupdate" type="checkbox" checked="checked">
		{{else}}
			<input id="autoupdate" type="checkbox">
		{{/if}}
		IP-Adresse automatisch updaten?
		</label>
	</form>
  </div>
  <div class="modal-footer">
  	{{{session "status"}}}
	{{#if session "JDOnlineStatus"}}
		<p class="pull-left">Dein JDownloader ist <strong style="color:green">online</strong>.</p>
	{{else}}
		<p class="pull-left">Dein JDownloader ist <strong style="color:red">offline</strong>.</p>
	{{/if}}
    <button class="btn cancel" data-dismiss="modal" aria-hidden="true">Schließen</button>
    <button class="btn btn-primary save">Speichern</button>
  </div>
</div>
</template>

<template name="addLinkDialog">
<div class="mask"> </div>
<div id="addLinkModal" class="modal">
  <div class="modal-header">
	<button type="button" class="close cancel">&times;</button>
    <h3 align="center">Link hinzufügen</h3>
  </div>
  <div class="modal-body">
	<form class="form-inline" id="addlinkform">
		<div class="input-append">
			<input id="newlinkurl" class="input-xlarge linkurl" type="url" placeholder="http://www28.zippyshare.com/v/82393135/file.html" required>
			<button class="btn addlink" type="button" disabled>Hinzufügen</button>
		</div>
	</form>
  </div>
  <div class="modal-footer status">
	    {{{session "status"}}}
  </div>
</div>
</template>

<template name="addSiteDialog">
<div class="mask"> </div>
<div id="addSiteModal" class="modal">
  <div class="modal-header">
	<button type="button" class="close cancel">&times;</button>
    <h3 align="center">Musik-Quelle hinzufügen</h3>
  </div>
  <div class="modal-body">
	<form class="form-horizontal" id="addsiteform">
		<div class="input-append">
			<span class="help-inline">URL der Seite, die wir nach Links durchsuchen sollen</span>
			<input id="newsiteurl" class="input-xlarge siteurl" type="url" placeholder="http://www.electrotechnosuperblog.com" required>
			<button class="btn addsite" disabled>Seite hinzufügen</button>
		</div>
	</form>
  </div>
  <div class="modal-footer status">
    {{{session "status"}}}
  </div>
</div>
</template>

<template name="sitesDialog">
<div class="mask"> </div>
<div id="showSitesModal" class="modal">
  <div class="modal-header">
	<button type="button" class="close cancel">&times;</button>
    <h3 align="center">Musik-Quellen</h3>
  </div>
  <div class="modal-body">
		<table class="table table-striped table-condensed">
		<thead>
			<th><i class="icon-trash"></i></th>
			<th>Name</th>
			<th>URL</th>
			<th>Typ</th>
			<th>aktiv</th>
		</thead>
		<tbody>
			{{#each sites}}
				<tr>
					<td>
						{{#if isOwner}}
							<i class="icon-trash hand"></i>
						{{/if}}
					</td>
					<td>
						{{#if isOwner}}
							<a class="sitename" data-mode="inline" data-name="name" data-type="text" data-pk="{{_id}}">{{name}}</a>
						{{else}}
							{{name}}
						{{/if}}
					</td>
					<td>{{feedurl}}</td>
					<td><i class="{{getFeedTypeIcon}}"></i></td>
					<td>
						{{#if active}}
							<i class="icon-ok-sign"></i>
						{{/if}}
					</td>
				</tr>
			{{/each}}
		</tbody>
		</table>
  </div>
</div>
</template>